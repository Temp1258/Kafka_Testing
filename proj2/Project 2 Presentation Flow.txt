ğŸ”¹Step 1: å¯åŠ¨å®¹å™¨ç¯å¢ƒ
ğŸ“Œ ç›®çš„ï¼šå¯åŠ¨ Kafkaã€Zookeeperã€PostgreSQL æºåº“å’Œç›®æ ‡åº“ã€‚

1ï¸âƒ£ æ‰“å¼€ Docker Desktop å¹¶ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨
2ï¸âƒ£ åœ¨ PowerShell è¿›å…¥ Project 2 ç›®å½•ï¼š
cd D:\BeaconFire\DE_February\Training\W6D3\KafkaProjects\BFS_DE_Kafka-main\proj2

3ï¸âƒ£ å¯åŠ¨å®¹å™¨ï¼š
docker-compose up -d

4ï¸âƒ£ æ£€æŸ¥å®¹å™¨çŠ¶æ€ï¼š
docker ps
âœ… é¢„æœŸè¾“å‡ºï¼šçœ‹åˆ°å®¹å™¨ kafka_proj2_db_sourceã€kafka_proj2_db_dstã€kafka_setup-kafka-1ã€kafka_setup-zookeeper-1 æ­£åœ¨è¿è¡Œã€‚
ğŸŸ© ã€æ›´æ”¹ç‚¹ã€‘ï¼šå®¹å™¨åå’Œ db å®¹å™¨ä¸å†æ˜¯ kafka_setup-db-1ï¼Œè€Œæ˜¯ä½ è‡ªå·±å‘½åçš„ kafka_proj2_db_source å’Œ kafka_proj2_db_dst

--------------------------------------------------------------------

æ¥DBeaveræ“ä½œï¼š
ğŸŸ¦ Step 1: æ‰“å¼€ DBeaverï¼Œè¿æ¥ PostgreSQL
ğŸ”¹ è¿æ¥ Source æ•°æ®åº“ï¼ˆdb_sourceï¼‰
æ‰“å¼€ DBeaver


é€‰æ‹© PostgreSQL

é…ç½®ä¿¡æ¯ï¼š
Host: 0.0.0.0
Port: 5433 âœ…ï¼ˆè¿™æ˜¯ db_source çš„ç«¯å£ï¼‰
Database: postgres
User: postgres
Password: postgres
ç‚¹å‡»â€œæµ‹è¯•è¿æ¥â€ â†’ ç¡®è®¤æ— è¯¯å â†’ ç‚¹å‡»â€œå®Œæˆâ€



ğŸŸ¦ Step 2: æ‰§è¡Œä½ ä¿å­˜çš„ SQL è„šæœ¬ï¼ˆåœ¨ db_source ä¸­ï¼‰
ğŸ“ å¯¹è±¡ï¼šè¿æ¥ db_source çš„ PostgreSQLï¼ˆ5433ï¼‰
åœ¨å·¦è¾¹å±•å¼€è¿æ¥ â†’ postgres2 (5433) â†’ å³é”® â†’ SQL ç¼–è¾‘å™¨ â†’ æ–°å»º SQL è„šæœ¬
ç²˜è´´ä¿å­˜çš„ DBeaver.sql å†…å®¹

--------------------------------------------------------------------

ğŸ”¹Step 2: æ£€æŸ¥ PostgreSQL æºåº“ç»“æ„
ğŸ“Œ ç›®çš„ï¼šéªŒè¯ employeesã€emp_cdc è¡¨ç»“æ„æ­£ç¡®å¹¶å¯¼å…¥æ•°æ®

è¿›å…¥ db_source å®¹å™¨ï¼š
docker exec -it kafka_proj2_db_source psql -U postgres
è¿æ¥æ•°æ®åº“ï¼š
\c postgres;

ç¡®è®¤è¡¨å­˜åœ¨ï¼š
SELECT * FROM employees;
SELECT * FROM emp_cdc;


--------------------------------------------------------------------

ğŸ”¹Step 3: éªŒè¯è§¦å‘å™¨é€»è¾‘æ˜¯å¦æ­£å¸¸
ğŸ“Œ ç›®çš„ï¼šéªŒè¯å¯¹ employees è¡¨è¿›è¡Œå˜æ›´æ—¶æ˜¯å¦åŒæ­¥è®°å½•åˆ° emp_cdc è¡¨ã€‚

æ‰§è¡Œä»¥ä¸‹ SQLï¼š
INSERT INTO employees (first_name, last_name, dob, city) 
VALUES ('John', 'Doe', '1990-01-01', 'New York');

UPDATE employees SET city = 'San Francisco' WHERE first_name = 'John';

DELETE FROM employees WHERE first_name = 'John';


ç„¶åæ‰§è¡Œï¼š
SELECT * FROM emp_cdc;
âœ… é¢„æœŸè¾“å‡ºï¼šèƒ½çœ‹åˆ°åˆšåˆš John çš„ 3 æ¡å˜æ›´è®°å½•ï¼ˆINSERT, UPDATE, DELETEï¼‰ã€‚



--------------------------------------------------------------------

ğŸ”¹Step 4: å¯åŠ¨ Kafka Producer
ğŸ“Œ ç›®çš„ï¼šProducer ä» emp_cdc è¡¨ä¸­æ‹‰å–å˜æ›´æ•°æ®å¹¶å‘é€è‡³ Kafka Topicã€‚

åœ¨ PowerShell è¿è¡Œï¼š
python producer.py
âœ… é¢„æœŸè¾“å‡ºï¼šæ— é”™è¯¯ï¼Œæ•°æ®å‘é€æˆåŠŸã€‚


--------------------------------------------------------------------

ğŸ”¹Step 5: éªŒè¯ Kafka ä¸­æ˜¯å¦æ”¶åˆ°æ•°æ®
ğŸ“Œ ç›®çš„ï¼šæŸ¥çœ‹ bf_employee_cdc Topic ä¸­æ˜¯å¦æœ‰å˜æ›´æ•°æ®ã€‚

è¿›å…¥ Kafka å®¹å™¨ï¼š
docker exec -it kafka_setup-kafka-1 bash
è¿è¡Œ Kafka Consumer CLIï¼š
/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:29092 --topic bf_employee_cdc --from-beginning
âœ… é¢„æœŸè¾“å‡ºï¼šä½ åº”è¯¥èƒ½çœ‹åˆ° JSON æ ¼å¼çš„ Kafka æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ action å­—æ®µï¼ˆå¦‚ INSERTã€UPDATEã€DELETEï¼‰

é€€å‡ºå®¹å™¨ï¼š
exit æˆ–è€…ctrl + c

--------------------------------------------------------------------

ğŸ”¹Step 6: å¯åŠ¨ Kafka Consumer å¹¶å†™å…¥ç›®æ ‡åº“
ğŸ“Œ ç›®çš„ï¼šKafka Consumer ç›‘å¬ Topicï¼Œå¹¶æ ¹æ® action å†™å…¥ employees_B

åœ¨ PowerShell è¿è¡Œï¼š
python consumer.py
âœ… é¢„æœŸè¾“å‡ºï¼šæ— æŠ¥é”™ï¼Œæ•°æ®æˆåŠŸå†™å…¥ç›®æ ‡æ•°æ®åº“ã€‚

--------------------------------------------------------------------


ğŸ”¹Step 7: æŸ¥çœ‹ç›®æ ‡åº“æ˜¯å¦åŒæ­¥æˆåŠŸ
ğŸ“Œ ç›®çš„ï¼šéªŒè¯ employees_B è¡¨æ˜¯å¦æ”¶åˆ° Kafka ä¸­çš„å˜æ›´æ•°æ®ã€‚

è¿›å…¥ç›®æ ‡åº“å®¹å™¨ï¼š
docker exec -it kafka_proj2_db_dst psql -U postgres
æ‰§è¡ŒæŸ¥è¯¢ï¼š
\c postgres;
SELECT * FROM employees_B;
âœ… é¢„æœŸè¾“å‡ºï¼šä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸ emp_cdc ä¸­æ•°æ®å¯¹åº”çš„å‘˜å·¥è®°å½•ã€‚

--------------------------------------------------------------------

ğŸ”¹Step 8: åœæ­¢æ‰€æœ‰å®¹å™¨ï¼ˆå¯é€‰ï¼‰
ğŸ“Œ å®Œæˆæ¼”ç¤ºåæ¸…ç†ç¯å¢ƒï¼š

docker-compose down




